<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚¹å‡»å¯åŠ¨ EmulatorJS æµ‹è¯•</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: Arial, sans-serif; }
        #emulator { width: 100vw; height: 100vh; background: #111; }
        .overlay { 
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(0,0,0,0.9); 
            display: flex; align-items: center; justify-content: center; 
            flex-direction: column; z-index: 1000; 
        }
        .start-button { 
            padding: 20px 40px; font-size: 24px; 
            background: #4CAF50; color: white; border: none; 
            border-radius: 10px; cursor: pointer; 
            margin: 20px; transition: all 0.3s;
        }
        .start-button:hover { background: #45a049; transform: scale(1.05); }
        .info { text-align: center; margin: 20px; }
        .status { position: absolute; top: 20px; left: 20px; 
                  background: rgba(0,0,0,0.8); padding: 15px; 
                  border-radius: 8px; max-width: 400px; 
                  font-size: 14px; line-height: 1.4; }
        .error { color: #ff4444; }
        .success { color: #44ff44; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="emulator"></div>
    
    <div id="overlay" class="overlay">
        <div class="info">
            <h1>ğŸ® EmulatorJS æµ‹è¯•</h1>
            <p>ç”±äºæµè§ˆå™¨å®‰å…¨ç­–ç•¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½å¯åŠ¨æ¸¸æˆ</p>
            <p><strong>æ¸¸æˆï¼š</strong>é­‚æ–—ç½— (FC/NES)</p>
            <p><strong>æ ¸å¿ƒï¼š</strong>fceumm</p>
        </div>
        <button id="startButton" class="start-button" onclick="startEmulator()">
            ğŸš€ ç‚¹å‡»å¯åŠ¨æ¸¸æˆ
        </button>
    </div>
    
    <div id="status" class="status hidden">
        <div id="statusText">å‡†å¤‡å¯åŠ¨...</div>
        <div id="progressText" style="font-size: 12px; margin-top: 10px;"></div>
    </div>

    <script>
        let statusVisible = false;
        
        function showStatus() {
            document.getElementById('status').classList.remove('hidden');
            statusVisible = true;
        }
        
        function updateStatus(message, isError = false, progress = '') {
            if (!statusVisible) showStatus();
            
            const statusEl = document.getElementById('statusText');
            const progressEl = document.getElementById('progressText');
            
            statusEl.textContent = message;
            statusEl.className = isError ? 'error' : 'success';
            progressEl.textContent = progress;
            
            console.log(message + (progress ? ' - ' + progress : ''));
        }
        
        function startEmulator() {
            // éšè—å¯åŠ¨ç•Œé¢
            document.getElementById('overlay').classList.add('hidden');
            showStatus();
            
            updateStatus('ğŸ® æ­£åœ¨åˆå§‹åŒ–EmulatorJS...');
            
            try {
                // è®¾ç½®EmulatorJSé…ç½®
                window.EJS_player = '#emulator';
                window.EJS_gameUrl = '/roms/Contra1(U)30.nes';
                window.EJS_system = 'nes';
                window.EJS_pathtodata = '/emulatorjs/data/';
                window.EJS_gameName = 'é­‚æ–—ç½—';
                window.EJS_startOnLoaded = true; // è‡ªåŠ¨å¼€å§‹æ¸¸æˆ
                
                updateStatus('ğŸ“¦ æ­£åœ¨åŠ è½½EmulatorJSæ ¸å¿ƒ...');
                
                // ç›‘å¬é”™è¯¯
                window.addEventListener('error', (e) => {
                    updateStatus('âŒ å‘ç”Ÿé”™è¯¯: ' + (e.error?.message || e.message), true);
                });
                
                window.addEventListener('unhandledrejection', (e) => {
                    updateStatus('âŒ Promiseé”™è¯¯: ' + e.reason, true);
                });
                
                // åŠ è½½EmulatorJS
                const script = document.createElement('script');
                script.src = '/emulatorjs/data/loader.js';
                
                script.onload = () => {
                    updateStatus('âœ… EmulatorJSåŠ è½½æˆåŠŸ', false, 'ç­‰å¾…åˆå§‹åŒ–...');
                    
                    // æ£€æŸ¥åˆå§‹åŒ–è¿›åº¦
                    let checkCount = 0;
                    const checkInit = setInterval(() => {
                        checkCount++;
                        
                        if (window.EJS_emulator) {
                            updateStatus('ğŸ¯ EmulatorJSå·²åˆå§‹åŒ–', false, 'å‡†å¤‡ä¸‹è½½æ¸¸æˆæ ¸å¿ƒ...');
                            clearInterval(checkInit);
                            
                            // ç›‘å¬å¯èƒ½çš„EmulatorJSäº‹ä»¶
                            if (window.EJS_emulator.on) {
                                window.EJS_emulator.on('ready', () => {
                                    updateStatus('ğŸ® æ¸¸æˆå‡†å¤‡å°±ç»ªï¼');
                                });
                                
                                window.EJS_emulator.on('start', () => {
                                    updateStatus('ğŸ•¹ï¸ æ¸¸æˆå·²å¼€å§‹è¿è¡Œï¼');
                                });
                            }
                            
                        } else if (checkCount > 50) { // 5ç§’åè¶…æ—¶
                            updateStatus('âš ï¸ EmulatorJSåˆå§‹åŒ–è¶…æ—¶', true);
                            clearInterval(checkInit);
                        } else {
                            updateStatus('â³ æ­£åœ¨åˆå§‹åŒ–EmulatorJS...', false, `${checkCount}/50`);
                        }
                    }, 100);
                };
                
                script.onerror = () => {
                    updateStatus('âŒ EmulatorJSåŠ è½½å¤±è´¥ï¼', true, 'è¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„');
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                updateStatus('âŒ å¯åŠ¨å¤±è´¥: ' + error.message, true);
                console.error('Startup error:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            console.log('é¡µé¢å·²åŠ è½½ï¼Œç­‰å¾…ç”¨æˆ·ç‚¹å‡»å¯åŠ¨');
        });
    </script>
</body>
</html> 