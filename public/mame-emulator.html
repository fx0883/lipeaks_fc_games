<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMEè¡—æœºæ¨¡æ‹Ÿå™¨ - EmulatorJS 4.2.3</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #e74c3c;
        }
        
        .game-selector {
            margin: 20px 0;
            text-align: center;
        }
        
        select, button {
            padding: 10px 15px;
            margin: 5px;
            font-size: 16px;
            background: #16213e;
            color: #fff;
            border: 1px solid #0f3460;
            border-radius: 4px;
            cursor: pointer;
        }
        
        select:hover, button:hover {
            background: #0f3460;
        }
        
        #emulator {
            width: 100%;
            height: 600px;
            background: #000;
            border: 2px solid #0f3460;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .info {
            background: #16213e;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #0f3460;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
        
        .status.loading { background: #f39c12; color: #000; }
        .status.ready { background: #27ae60; color: #fff; }
        .status.error { background: #e74c3c; color: #fff; }
        
        .arcade-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ•¹ï¸ MAMEè¡—æœºæ¨¡æ‹Ÿå™¨</h1>
        
        <div class="info">
            <h3>æ”¯æŒçš„è¡—æœºæ¸¸æˆ</h3>
            <p>å½“å‰æ”¯æŒMAME2003å’ŒMAME2003-Plusæ ¸å¿ƒçš„è¡—æœºæ¸¸æˆ</p>
        </div>
        
        <div class="game-selector">
            <label for="gameSelect">é€‰æ‹©æ¸¸æˆ:</label>
            <select id="gameSelect">
                <option value="">è¯·é€‰æ‹©æ¸¸æˆ...</option>
                <option value="19xx.zip">19XX: The War Against Destiny</option>
            </select>
            
            <label for="coreSelect">é€‰æ‹©æ ¸å¿ƒ:</label>
            <select id="coreSelect">
                <option value="mame2003_plus">MAME2003-Plus (æ¨è)</option>
                <option value="mame2003">MAME2003</option>
            </select>
            
            <button onclick="loadGame()">åŠ è½½æ¸¸æˆ</button>
            <button onclick="resetEmulator()">é‡ç½®</button>
        </div>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div id="emulator"></div>
        
        <div class="arcade-controls">
            <div class="info">
                <h3>ç©å®¶1æ“ä½œ</h3>
                <ul>
                    <li>æ–¹å‘é”®ï¼šæ‘‡æ†</li>
                    <li>Ctrlï¼šæŒ‰é’®1</li>
                    <li>Altï¼šæŒ‰é’®2</li>
                    <li>Spaceï¼šæŒ‰é’®3</li>
                    <li>Shiftï¼šæŒ‰é’®4</li>
                    <li>Zï¼šæŒ‰é’®5</li>
                    <li>Xï¼šæŒ‰é’®6</li>
                </ul>
            </div>
            <div class="info">
                <h3>ç³»ç»Ÿæ“ä½œ</h3>
                <ul>
                    <li>5ï¼šæŠ•å¸</li>
                    <li>1ï¼š1På¼€å§‹</li>
                    <li>2ï¼š2På¼€å§‹</li>
                    <li>Tabï¼šèœå•</li>
                    <li>Pï¼šæš‚åœ</li>
                    <li>F2ï¼šé‡ç½®</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let emulatorLoaded = false;
        
        // ç§»åŠ¨è®¾å¤‡æ£€æµ‹å’Œè™šæ‹Ÿæ‰‹æŸ„é…ç½®å‡½æ•°
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   ('ontouchstart' in window) ||
                   (navigator.maxTouchPoints > 0) ||
                   (window.innerWidth <= 768);
        }
        
        function getMAMEVirtualGamepadSettings(orientation = 'landscape') {
            const isPortrait = orientation === 'portrait';
            
            return [
                // æ‘‡æ† (å·¦ä¾§ï¼Œä¸å³ä¾§æŒ‰é’®å¯¹ç§°)
                {
                    type: "dpad",
                    location: "left",
                    left: isPortrait ? "8%" : "12%",
                    top: isPortrait ? "68%" : "58%", // ä¸å³ä¾§æŒ‰é’®ä¸­å¿ƒå¯¹é½
                    inputValues: [4, 5, 6, 7], // ä¸Šä¸‹å·¦å³
                    size: isPortrait ? 110 : 100
                },
                
                // å³ä¾§4æŒ‰é’®å¸ƒå±€ (åå­—å½¢ï¼Œä¸å·¦ä¾§æ‘‡æ†å¯¹ç§°)
                // ä¸ŠæŒ‰é’®: 1
                {
                    type: "button",
                    text: "1",
                    id: "btn1",
                    location: "right",
                    left: isPortrait ? 75 : 72,
                    top: isPortrait ? 50 : 40,
                    bold: true,
                    input_value: 0, // æŒ‰é’®1
                    size: isPortrait ? 45 : 42
                },
                
                // å·¦æŒ‰é’®: 4
                {
                    type: "button", 
                    text: "4",
                    id: "btn4",
                    location: "right",
                    left: isPortrait ? 58 : 55,
                    top: isPortrait ? 68 : 58, // ä¸æ‘‡æ†ä¸­å¿ƒå¯¹é½
                    bold: true,
                    input_value: 9, // æŒ‰é’®4
                    size: isPortrait ? 45 : 42
                },
                
                // å³æŒ‰é’®: 2
                {
                    type: "button", 
                    text: "2",
                    id: "btn2",
                    location: "right",
                    left: isPortrait ? 92 : 89,
                    top: isPortrait ? 68 : 58, // ä¸æ‘‡æ†ä¸­å¿ƒå¯¹é½
                    bold: true,
                    input_value: 8, // æŒ‰é’®2
                    size: isPortrait ? 45 : 42
                },
                
                // ä¸‹æŒ‰é’®: 3
                {
                    type: "button",
                    text: "3",
                    id: "btn3",
                    location: "right",
                    left: isPortrait ? 75 : 72,
                    top: isPortrait ? 86 : 76,
                    bold: true,
                    input_value: 1, // æŒ‰é’®3
                    size: isPortrait ? 45 : 42
                },
                
                // ç³»ç»ŸæŒ‰é’® (åœ†è§’é•¿æ–¹å½¢)
                {
                    type: "button",
                    text: "COIN",
                    id: "coin",
                    location: "center",
                    left: isPortrait ? 25 : 30,
                    top: isPortrait ? 20 : 15,
                    bold: false,
                    input_value: 2, // SELECTé”®ä½œä¸ºæŠ•å¸
                    size: isPortrait ? 35 : 30,
                    shape: "rounded-rect", // åœ†è§’é•¿æ–¹å½¢
                    width: isPortrait ? 60 : 55,
                    height: isPortrait ? 25 : 20
                },
                {
                    type: "button",
                    text: "START",
                    id: "start",
                    location: "center",
                    left: isPortrait ? 75 : 70,
                    top: isPortrait ? 20 : 15,
                    bold: false,
                    input_value: 3,
                    size: isPortrait ? 35 : 30,
                    shape: "rounded-rect", // åœ†è§’é•¿æ–¹å½¢
                    width: isPortrait ? 60 : 55,
                    height: isPortrait ? 25 : 20
                }
            ];
        }
        
        function showStatus(message, type = 'loading') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
        }
        
        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }
        
        function loadGame() {
            const gameSelect = document.getElementById('gameSelect');
            const coreSelect = document.getElementById('coreSelect');
            
            const gameName = gameSelect.value;
            const core = coreSelect.value;
            
            if (!gameName) {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªæ¸¸æˆï¼');
                return;
            }
            
            showStatus('æ­£åœ¨åŠ è½½è¡—æœºæ¸¸æˆ...', 'loading');
            
            // æ¸…ç†ä¹‹å‰çš„å®ä¾‹
            resetEmulator();
            
            // è®¾ç½®EmulatorJSå…¨å±€é…ç½®
            window.EJS_player = '#emulator';
            window.EJS_gameUrl = `/roms/${gameName}`;
            window.EJS_core = core;
            window.EJS_pathtodata = '/emulatorjs/';
            window.EJS_gameName = gameName.replace('.zip', '');
            window.EJS_startOnLoaded = true;
            window.EJS_DEBUG_XX = false;
            window.EJS_disableDatabases = true;
            window.EJS_volume = 0.8;
            
            // è¡—æœºç‰¹å®šé…ç½®
            window.EJS_lightgun = false;
            window.EJS_mouse = false;
            
            // ç§»åŠ¨ç«¯è™šæ‹Ÿæ‰‹æŸ„é…ç½®
            if (isMobileDevice()) {
                const isPortrait = window.innerHeight > window.innerWidth;
                window.EJS_VirtualGamepadSettings = getMAMEVirtualGamepadSettings(isPortrait ? 'portrait' : 'landscape');
                window.EJS_noAutoFocus = true;
            }
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬
            window.EJS_ready = function() {
                showStatus('è¡—æœºæ¨¡æ‹Ÿå™¨å°±ç»ªï¼è¯·æŠ•å¸å¼€å§‹æ¸¸æˆ', 'ready');
                setTimeout(hideStatus, 4000);
            };
            
            window.EJS_onGameStart = function() {
                showStatus('è¡—æœºæ¸¸æˆå¼€å§‹ï¼', 'ready');
                setTimeout(hideStatus, 2000);
            };
            
            // åŠ è½½EmulatorJS
            const script = document.createElement('script');
            script.src = '/emulatorjs/loader.js';
            script.onload = function() {
                console.log('MAME EmulatorJS loader åŠ è½½æˆåŠŸ');
                emulatorLoaded = true;
            };
            script.onerror = function() {
                showStatus('åŠ è½½è¡—æœºæ¨¡æ‹Ÿå™¨å¤±è´¥ï¼', 'error');
                console.error('MAME EmulatorJS loader åŠ è½½å¤±è´¥');
            };
            
            document.head.appendChild(script);
        }
        
        function resetEmulator() {
            // æ¸…ç†DOM
            const emulatorEl = document.getElementById('emulator');
            emulatorEl.innerHTML = '';
            
            // æ¸…ç†å…¨å±€å˜é‡
            if (window.EJS_emulator) {
                delete window.EJS_emulator;
            }
            
            // ç§»é™¤ä¹‹å‰çš„è„šæœ¬
            const scripts = document.querySelectorAll('script[src*="loader.js"]');
            scripts.forEach(script => script.remove());
            
            emulatorLoaded = false;
            hideStatus();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('MAMEæ¨¡æ‹Ÿå™¨é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html> 