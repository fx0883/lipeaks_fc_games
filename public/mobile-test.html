<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ç§»åŠ¨ç«¯è§¦æ‘¸æ§åˆ¶æµ‹è¯?/title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .mobile-header {
            background: #1a1a1a;
            padding: 10px;
            text-align: center;
            font-size: 14px;
        }
        
        .device-info {
            background: #333;
            padding: 8px;
            font-size: 12px;
            text-align: center;
        }
        
        .game-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background: #222;
        }
        
        .game-btn {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .game-btn:hover {
            background: #45a049;
        }
        
        .game-btn.mame {
            background: #FF5722;
        }
        
        .game-btn.mame:hover {
            background: #E64A19;
        }
        
        #emulator {
            width: 100%;
            height: calc(100vh - 120px);
            background: #111;
            position: relative;
        }
        
        .status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            z-index: 100;
        }
        
        .controls-hint {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 11px;
            z-index: 200;
        }
        
        /* å…¨å±æ—¶éšè—å¤´éƒ?*/
        body:-webkit-full-screen .mobile-header,
        body:-moz-full-screen .mobile-header,
        body:fullscreen .mobile-header {
            display: none;
        }
        
        body:-webkit-full-screen .device-info,
        body:-moz-full-screen .device-info,
        body:fullscreen .device-info {
            display: none;
        }
        
        body:-webkit-full-screen .game-selector,
        body:-moz-full-screen .game-selector,
        body:fullscreen .game-selector {
            display: none;
        }
        
        body:-webkit-full-screen #emulator,
        body:-moz-full-screen #emulator,
        body:fullscreen #emulator {
            height: 100vh;
        }
    </style>
</head>
<body>
    <div class="mobile-header">
        ğŸ“± ç§»åŠ¨ç«¯è§¦æ‘¸æ§åˆ¶æµ‹è¯?
    </div>
    
    <div class="device-info" id="deviceInfo">
        æ£€æµ‹ä¸­...
    </div>
    
    <div class="game-selector">
        <button class="game-btn" onclick="loadFC()">FCæ¸¸æˆ (é­‚æ–—ç½?</button>
        <button class="game-btn mame" onclick="loadMAME()">è¡—æœºæ¸¸æˆ (19XX)</button>
        <button class="game-btn" onclick="toggleFullscreen()" style="background: #2196F3;">å…¨å±æµ‹è¯•</button>
    </div>
    
    <div id="emulator">
        <div class="status" id="status">
            <h3>ğŸ® ç§»åŠ¨ç«¯æ¸¸æˆæµ‹è¯?/h3>
            <p>é€‰æ‹©ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯?/p>
            <p style="margin-top: 10px; font-size: 12px;">
                åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå…¨å±æ—¶ä¼šæ˜¾ç¤ºè™šæ‹Ÿæ‰‹æŸ„
            </p>
        </div>
        
        <div class="controls-hint" id="controlsHint" style="display: none;">
            è§¦æ‘¸æ§åˆ¶å·²å¯ç”?- ä½¿ç”¨è™šæ‹Ÿæ‰‹æŸ„æ¸¸ç©
        </div>
    </div>

    <script>
        let emulatorLoaded = false;
        let currentGame = null;
        
        // ç§»åŠ¨è®¾å¤‡æ£€æµ?
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   ('ontouchstart' in window) ||
                   (navigator.maxTouchPoints > 0) ||
                   (window.innerWidth <= 768);
        }
        
        function getDeviceOrientation() {
            return window.innerHeight > window.innerWidth ? 'portrait' : 'landscape';
        }
        
        // FCè™šæ‹Ÿæ‰‹æŸ„é…ç½® (4æŒ‰é’®å¸ƒå±€)
        function getFCVirtualGamepadSettings(orientation = 'landscape') {
            const isPortrait = orientation === 'portrait';
            
            return [
                // æ–¹å‘é”?(å·¦ä¾§ï¼Œä¸å³ä¾§æŒ‰é’®å¯¹ç§°)
                {
                    type: "dpad",
                    location: "left",
                    left: isPortrait ? "8%" : "12%",
                    top: isPortrait ? "68%" : "58%", // ä¸å³ä¾§æŒ‰é’®ä¸­å¿ƒå¯¹é½?
                    inputValues: [4, 5, 6, 7], // ä¸Šä¸‹å·¦å³
                    size: isPortrait ? 100 : 90
                },
                
                // å³ä¾§4æŒ‰é’®å¸ƒå±€ (åå­—å½¢ï¼Œä¸å·¦ä¾§æ–¹å‘é”®å¯¹ç§°)
                // ä¸ŠæŒ‰é’? Y
                {
                    type: "button",
                    text: "Y",
                    id: "y",
                    location: "right",
                    left: isPortrait ? 75 : 72,
                    top: isPortrait ? 50 : 40,
                    bold: true,
                    input_value: 9, // YæŒ‰é’®
                    size: isPortrait ? 45 : 42
                },
                
                // å·¦æŒ‰é’? X
                {
                    type: "button", 
                    text: "X",
                    id: "x",
                    location: "right",
                    left: isPortrait ? 58 : 55,
                    top: isPortrait ? 68 : 58,
                    bold: true,
                    input_value: 1, // XæŒ‰é’®
                    size: isPortrait ? 45 : 42
                },
                
                // å³æŒ‰é’? A (FCä¼ ç»Ÿå¸ƒå±€)
                {
                    type: "button",
                    text: "A",
                    id: "a",
                    location: "right",
                    left: isPortrait ? 92 : 89,
                    top: isPortrait ? 68 : 58,
                    bold: true,
                    input_value: 8, // AæŒ‰é’®
                    size: isPortrait ? 45 : 42
                },
                
                // ä¸‹æŒ‰é’? B
                {
                    type: "button", 
                    text: "B",
                    id: "b",
                    location: "right",
                    left: isPortrait ? 75 : 72,
                    top: isPortrait ? 86 : 76,
                    bold: true,
                    input_value: 0, // BæŒ‰é’®
                    size: isPortrait ? 45 : 42
                },
                
                // ç³»ç»ŸæŒ‰é’® (åœ†è§’é•¿æ–¹å½?
                {
                    type: "button",
                    text: "SELECT",
                    id: "select",
                    location: "center",
                    left: isPortrait ? 35 : 40,
                    top: isPortrait ? 35 : 20,
                    bold: false,
                    input_value: 2,
                    size: isPortrait ? 35 : 30,
                    shape: "rounded-rect", // åœ†è§’é•¿æ–¹å½?
                    width: isPortrait ? 60 : 55,
                    height: isPortrait ? 25 : 20
                },
                {
                    type: "button",
                    text: "START",
                    id: "start",
                    location: "center",
                    left: isPortrait ? 65 : 60,
                    top: isPortrait ? 35 : 20,
                    bold: false,
                    input_value: 3,
                    size: isPortrait ? 35 : 30,
                    shape: "rounded-rect", // åœ†è§’é•¿æ–¹å½?
                    width: isPortrait ? 60 : 55,
                    height: isPortrait ? 25 : 20
                }
            ];
        }
        
        // MAMEè™šæ‹Ÿæ‰‹æŸ„é…ç½® (4æŒ‰é’®å¸ƒå±€)
        function getMAMEVirtualGamepadSettings(orientation = 'landscape') {
            const isPortrait = orientation === 'portrait';
            
            return [
                // æ‘‡æ† (å·¦ä¾§ï¼Œä¸å³ä¾§æŒ‰é’®å¯¹ç§°)
                {
                    type: "dpad",
                    location: "left",
                    left: isPortrait ? "8%" : "12%",
                    top: isPortrait ? "68%" : "58%", // ä¸å³ä¾§æŒ‰é’®ä¸­å¿ƒå¯¹é½?
                    inputValues: [4, 5, 6, 7], // ä¸Šä¸‹å·¦å³
                    size: isPortrait ? 110 : 100
                },
                
                // å³ä¾§4æŒ‰é’®å¸ƒå±€ (åå­—å½¢ï¼Œä¸å·¦ä¾§æ‘‡æ†å¯¹ç§?
                // ä¸ŠæŒ‰é’? 1
                {
                    type: "button",
                    text: "1",
                    id: "btn1",
                    location: "right",
                    left: isPortrait ? 75 : 72,
                    top: isPortrait ? 50 : 40,
                    bold: true,
                    input_value: 0, // æŒ‰é’®1
                    size: isPortrait ? 45 : 42
                },
                
                // å·¦æŒ‰é’? 4
                {
                    type: "button", 
                    text: "4",
                    id: "btn4",
                    location: "right",
                    left: isPortrait ? 58 : 55,
                    top: isPortrait ? 68 : 58,
                    bold: true,
                    input_value: 9, // æŒ‰é’®4
                    size: isPortrait ? 45 : 42
                },
                
                // å³æŒ‰é’? 2
                {
                    type: "button", 
                    text: "2",
                    id: "btn2",
                    location: "right",
                    left: isPortrait ? 92 : 89,
                    top: isPortrait ? 68 : 58,
                    bold: true,
                    input_value: 8, // æŒ‰é’®2
                    size: isPortrait ? 45 : 42
                },
                
                // ä¸‹æŒ‰é’? 3
                {
                    type: "button",
                    text: "3",
                    id: "btn3",
                    location: "right",
                    left: isPortrait ? 75 : 72,
                    top: isPortrait ? 86 : 76,
                    bold: true,
                    input_value: 1, // æŒ‰é’®3
                    size: isPortrait ? 45 : 42
                },
                
                // ç³»ç»ŸæŒ‰é’® (åœ†è§’é•¿æ–¹å½?
                {
                    type: "button",
                    text: "COIN",
                    id: "coin",
                    location: "center",
                    left: isPortrait ? 25 : 30,
                    top: isPortrait ? 20 : 15,
                    bold: false,
                    input_value: 2, // SELECTé”®ä½œä¸ºæŠ•å¸?
                    size: isPortrait ? 35 : 30,
                    shape: "rounded-rect", // åœ†è§’é•¿æ–¹å½?
                    width: isPortrait ? 60 : 55,
                    height: isPortrait ? 25 : 20
                },
                {
                    type: "button",
                    text: "START",
                    id: "start",
                    location: "center",
                    left: isPortrait ? 75 : 70,
                    top: isPortrait ? 20 : 15,
                    bold: false,
                    input_value: 3,
                    size: isPortrait ? 35 : 30,
                    shape: "rounded-rect", // åœ†è§’é•¿æ–¹å½?
                    width: isPortrait ? 60 : 55,
                    height: isPortrait ? 25 : 20
                }
            ];
        }
        
        function updateStatus(message) {
            document.getElementById('status').innerHTML = `<h3>ğŸ® ${message}</h3>`;
        }
        
        function resetEmulator() {
            document.getElementById('emulator').innerHTML = `
                <div class="status" id="status">
                    <h3>ğŸ® ç§»åŠ¨ç«¯æ¸¸æˆæµ‹è¯?/h3>
                    <p>é€‰æ‹©ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯?/p>
                </div>
            `;
            if (window.EJS_emulator) delete window.EJS_emulator;
            emulatorLoaded = false;
            currentGame = null;
        }
        
        function loadFC() {
            resetEmulator();
            updateStatus('æ­£åœ¨åŠ è½½FCæ¸¸æˆ...');
            currentGame = 'fc';
            
            // è®¾ç½®FCæ¸¸æˆé…ç½®
            window.EJS_player = '#emulator';
            window.EJS_gameUrl = '/roms/Contra1(U)30.nes';
            window.EJS_core = 'fceumm';
            window.EJS_pathtodata = 'https://cdn.emulatorjs.org/4.2.3/data/';
            window.EJS_gameName = 'é­‚æ–—ç½?;
            window.EJS_startOnLoaded = true;
            window.EJS_DEBUG_XX = true;
            
            // ç§»åŠ¨ç«¯é…ç½?
            if (isMobileDevice()) {
                const orientation = getDeviceOrientation();
                window.EJS_VirtualGamepadSettings = getFCVirtualGamepadSettings(orientation);
                window.EJS_noAutoFocus = true;
                document.getElementById('controlsHint').style.display = 'block';
            }
            
            window.EJS_ready = () => updateStatus('FCæ¸¸æˆå°±ç»ªï¼å…¨å±æŸ¥çœ‹è™šæ‹Ÿæ‰‹æŸ?);
            window.EJS_onGameStart = () => updateStatus('é­‚æ–—ç½—å¼€å§‹ï¼');
            
            loadEmulatorScript();
        }
        
        function loadMAME() {
            resetEmulator();
            updateStatus('æ­£åœ¨åŠ è½½è¡—æœºæ¸¸æˆ...');
            currentGame = 'mame';
            
            // è®¾ç½®MAMEæ¸¸æˆé…ç½®
            window.EJS_player = '#emulator';
            window.EJS_gameUrl = '/roms/19xx.zip';
            window.EJS_core = 'mame2003_plus';
            window.EJS_pathtodata = 'https://cdn.emulatorjs.org/4.2.3/data/';
            window.EJS_gameName = '19XX';
            window.EJS_startOnLoaded = true;
            window.EJS_DEBUG_XX = true;
            
            // ç§»åŠ¨ç«¯é…ç½?
            if (isMobileDevice()) {
                const orientation = getDeviceOrientation();
                window.EJS_VirtualGamepadSettings = getMAMEVirtualGamepadSettings(orientation);
                window.EJS_noAutoFocus = true;
                document.getElementById('controlsHint').style.display = 'block';
            }
            
            window.EJS_ready = () => updateStatus('è¡—æœºæ¸¸æˆå°±ç»ªï¼å…¨å±æŸ¥çœ‹è™šæ‹Ÿæ‰‹æŸ?);
            window.EJS_onGameStart = () => updateStatus('19XXå¼€å§‹ï¼');
            
            loadEmulatorScript();
        }
        
        function loadEmulatorScript() {
            const script = document.createElement('script');
            script.src = 'https://cdn.emulatorjs.org/4.2.3/data/loader.js';
            script.onload = () => {
                console.log('EmulatorJSå·²åŠ è½?);
                emulatorLoaded = true;
            };
            script.onerror = () => updateStatus('åŠ è½½å¤±è´¥ï¼?);
            document.head.appendChild(script);
        }
        
        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.body.requestFullscreen().catch(err => {
                    console.log('å…¨å±è¯·æ±‚å¤±è´¥:', err);
                });
            }
        }
        
        // è®¾å¤‡ä¿¡æ¯æ˜¾ç¤º
        function updateDeviceInfo() {
            const info = document.getElementById('deviceInfo');
            const mobile = isMobileDevice();
            const touch = 'ontouchstart' in window;
            const orientation = getDeviceOrientation();
            const size = `${window.innerWidth}x${window.innerHeight}`;
            
            info.textContent = `è®¾å¤‡: ${mobile ? 'ç§»åŠ¨ç«? : 'æ¡Œé¢ç«?} | è§¦æ‘¸: ${touch ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ?} | æ–¹å‘: ${orientation} | å°ºå¯¸: ${size}`;
        }
        
        // ç›‘å¬æ–¹å‘å˜åŒ–
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                updateDeviceInfo();
                // å¦‚æœæ¸¸æˆæ­£åœ¨è¿è¡Œï¼Œé‡æ–°é…ç½®è™šæ‹Ÿæ‰‹æŸ?
                if (emulatorLoaded && currentGame && isMobileDevice()) {
                    const orientation = getDeviceOrientation();
                    if (currentGame === 'fc') {
                        window.EJS_VirtualGamepadSettings = getFCVirtualGamepadSettings(orientation);
                    } else if (currentGame === 'mame') {
                        window.EJS_VirtualGamepadSettings = getMAMEVirtualGamepadSettings(orientation);
                    }
                }
            }, 500);
        });
        
        window.addEventListener('resize', updateDeviceInfo);
        
        // å…¨å±çŠ¶æ€ç›‘å?
        document.addEventListener('fullscreenchange', () => {
            const isFullscreen = !!document.fullscreenElement;
            if (isFullscreen && emulatorLoaded) {
                updateStatus('å…¨å±æ¨¡å¼ - è™šæ‹Ÿæ‰‹æŸ„å·²å¯ç”?);
            }
        });
        
        // åˆå§‹åŒ?
        updateDeviceInfo();
    </script>
</body>
</html> 
