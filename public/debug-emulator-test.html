<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯• EmulatorJS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; background: #2d2d2d; border-radius: 8px; }
        .emulator-area { height: 400px; background: #000; border: 2px solid #4CAF50; border-radius: 5px; margin: 10px 0; }
        .debug-area { height: 300px; background: #1e1e1e; border: 1px solid #666; padding: 10px; overflow-y: auto; font-family: monospace; font-size: 12px; }
        button { padding: 10px 20px; margin: 5px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        button.warning { background: #ff9800; }
        button.danger { background: #f44336; }
        .status { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .status.success { background: #4CAF50; }
        .status.error { background: #f44336; }
        .status.info { background: #2196F3; }
        .status.warning { background: #ff9800; color: #000; }
        h1, h2 { color: #4CAF50; margin-bottom: 10px; }
        pre { background: #000; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ EmulatorJS æ·±åº¦è°ƒè¯•</h1>
        
        <div class="section">
            <h2>æ§åˆ¶é¢æ¿</h2>
            <button onclick="runDiagnostics()">è¿è¡Œå®Œæ•´è¯Šæ–­</button>
            <button onclick="testFC()">æµ‹è¯•FCæ¸¸æˆ</button>
            <button onclick="testMAME()" class="warning">æµ‹è¯•MAMEæ¸¸æˆ</button>
            <button onclick="enableDebugMode()">å¯ç”¨è°ƒè¯•æ¨¡å¼</button>
            <button onclick="clearAll()" class="danger">æ¸…ç©ºæ‰€æœ?/button>
        </div>

        <div class="section">
            <h2>æ¨¡æ‹Ÿå™¨åŒºåŸ?/h2>
            <div id="emulator" class="emulator-area">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #888;">
                    ğŸ® ç­‰å¾…æµ‹è¯•...
                </div>
            </div>
        </div>

        <div class="section">
            <h2>å®æ—¶è°ƒè¯•æ—¥å¿—</h2>
            <div id="debug-output" class="debug-area">å‡†å¤‡å¼€å§‹è°ƒè¯?..</div>
        </div>

        <div class="section">
            <h2>çŠ¶æ€æŠ¥å‘?/h2>
            <div id="status-area">
                <div class="status info">âœ?è°ƒè¯•é¡µé¢å·²å°±ç»?/div>
            </div>
        </div>
    </div>

    <script>
        let debugLog = [];
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;
        let originalConsoleWarn = console.warn;

        // åŠ«æŒconsoleè¾“å‡º
        console.log = function(...args) {
            addDebug('LOG', args.join(' '));
            originalConsoleLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addDebug('ERROR', args.join(' '));
            originalConsoleError.apply(console, args);
        };
        
        console.warn = function(...args) {
            addDebug('WARN', args.join(' '));
            originalConsoleWarn.apply(console, args);
        };

        function addDebug(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${type}: ${message}`;
            debugLog.push(entry);
            updateDebugOutput();
        }

        function updateDebugOutput() {
            const output = document.getElementById('debug-output');
            output.innerHTML = debugLog.slice(-50).map(entry => {
                const color = entry.includes('ERROR') ? '#ff4444' : 
                             entry.includes('WARN') ? '#ffaa00' : 
                             entry.includes('SUCCESS') ? '#44ff44' : '#ffffff';
                return `<div style="color: ${color}">${entry}</div>`;
            }).join('');
            output.scrollTop = output.scrollHeight;
        }

        function addStatus(message, type = 'info') {
            const statusArea = document.getElementById('status-area');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusArea.appendChild(statusDiv);
            if (statusArea.children.length > 10) {
                statusArea.removeChild(statusArea.firstChild);
            }
        }

        async function runDiagnostics() {
            addDebug('INFO', 'ğŸ” å¼€å§‹è¿è¡Œå®Œæ•´è¯Šæ–?..');
            addStatus('å¼€å§‹ç³»ç»Ÿè¯Šæ–?..', 'info');

            // æ£€æŸ¥å…³é”®æ–‡ä»?
            const criticalFiles = [
                'https://cdn.emulatorjs.org/4.2.3/data/emulator.min.js',
                'https://cdn.emulatorjs.org/4.2.3/data/emulator.min.css',
                'https://cdn.emulatorjs.org/4.2.3/data/loader.js',
                'https://cdn.emulatorjs.org/4.2.3/data/localization/zh-CN.json',
                'https://cdn.emulatorjs.org/4.2.3/data/cores/fceumm-wasm.data',
                'https://cdn.emulatorjs.org/4.2.3/data/cores/mame2003-wasm.data',
                'https://cdn.emulatorjs.org/4.2.3/data/cores/reports/fceumm.json',
                'https://cdn.emulatorjs.org/4.2.3/data/cores/reports/mame2003.json',
                '/roms/Contra1(U)30.nes',
                '/roms/19xx.zip'
            ];

            for (const file of criticalFiles) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        addDebug('SUCCESS', `âœ?æ–‡ä»¶å­˜åœ¨: ${file}`);
                    } else {
                        addDebug('ERROR', `â?æ–‡ä»¶è®¿é—®å¤±è´¥: ${file} (${response.status})`);
                        addStatus(`æ–‡ä»¶ç¼ºå¤±: ${file}`, 'error');
                    }
                } catch (error) {
                    addDebug('ERROR', `â?æ–‡ä»¶æ£€æŸ¥é”™è¯? ${file} - ${error.message}`);
                    addStatus(`æ–‡ä»¶æ£€æŸ¥é”™è¯? ${file}`, 'error');
                }
            }

            // æ£€æŸ¥å…¨å±€å˜é‡
            addDebug('INFO', 'ğŸ” æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€?..');
            addDebug('INFO', `WebAssemblyæ”¯æŒ: ${typeof WebAssembly !== 'undefined' ? 'âœ? : 'â?}`);
            addDebug('INFO', `Web Workersæ”¯æŒ: ${typeof Worker !== 'undefined' ? 'âœ? : 'â?}`);
            
            addStatus('è¯Šæ–­å®Œæˆï¼Œè¯·æŸ¥çœ‹è°ƒè¯•æ—¥å¿—', 'success');
        }

        function clearAll() {
            // æ¸…ç©ºæ¨¡æ‹Ÿå™?
            const emulator = document.getElementById('emulator');
            emulator.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #888;">ğŸ® ç­‰å¾…æµ‹è¯•...</div>';
            
            // æ¸…ç†å…¨å±€å˜é‡
            delete window.EJS_emulator;
            delete window.EJS_player;
            delete window.EJS_gameUrl;
            delete window.EJS_system;
            delete window.EJS_pathtodata;
            delete window.EJS_gameName;
            
            // ç§»é™¤EmulatorJSè„šæœ¬
            const scripts = document.querySelectorAll('script[src*="loader.js"], script[src*="emulator"]');
            scripts.forEach(script => script.remove());
            
            addDebug('INFO', 'ğŸ§¹ å·²æ¸…ç©ºæ‰€æœ‰æ¨¡æ‹Ÿå™¨çŠ¶æ€?);
            addStatus('æ¨¡æ‹Ÿå™¨å·²é‡ç½®', 'info');
        }

        function enableDebugMode() {
            window.EJS_DEBUG_XX = true;
            addDebug('INFO', 'ğŸ”§ å·²å¯ç”¨EmulatorJSè°ƒè¯•æ¨¡å¼');
            addStatus('è°ƒè¯•æ¨¡å¼å·²å¯ç”?, 'warning');
        }

        function testFC() {
            clearAll();
            addDebug('INFO', 'ğŸ•¹ï¸?å¼€å§‹æµ‹è¯•FC/NESæ¸¸æˆ...');
            addStatus('æ­£åœ¨æµ‹è¯•FCæ¸¸æˆ...', 'info');

            try {
                // è®¾ç½®é…ç½®
                window.EJS_player = '#emulator';
                window.EJS_gameUrl = '/roms/Contra1(U)30.nes';
                window.EJS_system = 'nes';  // ä¿®æ­£ï¼šä½¿ç”?nes'è€Œä¸æ˜?fceumm'
                window.EJS_pathtodata = 'https://cdn.emulatorjs.org/4.2.3/data/';
                window.EJS_gameName = 'FCé­‚æ–—ç½—è°ƒè¯•æµ‹è¯?;
                window.EJS_DEBUG_XX = true; // å¼ºåˆ¶å¯ç”¨è°ƒè¯•

                addDebug('INFO', `é…ç½®è®¾ç½®å®Œæˆ: ç³»ç»Ÿ=${window.EJS_system}, æ¸¸æˆ=${window.EJS_gameUrl}`);

                // ç›‘å¬é”™è¯¯
                window.addEventListener('error', (e) => {
                    addDebug('ERROR', `å…¨å±€é”™è¯¯: ${e.error?.message || e.message}`);
                });

                // åŠ è½½EmulatorJS
                const script = document.createElement('script');
                script.src = 'https://cdn.emulatorjs.org/4.2.3/data/loader.js';
                script.onload = () => {
                    addDebug('SUCCESS', 'âœ?loader.jsåŠ è½½æˆåŠŸ');
                    addStatus('LoaderåŠ è½½æˆåŠŸ', 'success');
                };
                script.onerror = (error) => {
                    addDebug('ERROR', `â?loader.jsåŠ è½½å¤±è´¥: ${error}`);
                    addStatus('LoaderåŠ è½½å¤±è´¥', 'error');
                };
                document.head.appendChild(script);

            } catch (error) {
                addDebug('ERROR', `â?FCæµ‹è¯•åˆå§‹åŒ–å¤±è´? ${error.message}`);
                addStatus('FCæµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testMAME() {
            clearAll();
            addDebug('INFO', 'ğŸ° å¼€å§‹æµ‹è¯•MAMEæ¸¸æˆ...');
            addStatus('æ­£åœ¨æµ‹è¯•MAMEæ¸¸æˆ...', 'info');

            try {
                // è®¾ç½®é…ç½®
                window.EJS_player = '#emulator';
                window.EJS_gameUrl = '/roms/19xx.zip';
                window.EJS_system = 'mame';  // ä¿®æ­£ï¼šä½¿ç”?mame'è€Œä¸æ˜?mame2003'
                window.EJS_pathtodata = 'https://cdn.emulatorjs.org/4.2.3/data/';
                window.EJS_gameName = 'MAMEè°ƒè¯•æµ‹è¯•';
                window.EJS_DEBUG_XX = true;

                addDebug('INFO', `é…ç½®è®¾ç½®å®Œæˆ: ç³»ç»Ÿ=${window.EJS_system}, æ¸¸æˆ=${window.EJS_gameUrl}`);

                // åŠ è½½EmulatorJS
                const script = document.createElement('script');
                script.src = 'https://cdn.emulatorjs.org/4.2.3/data/loader.js';
                script.onload = () => {
                    addDebug('SUCCESS', 'âœ?loader.jsåŠ è½½æˆåŠŸ');
                    addStatus('LoaderåŠ è½½æˆåŠŸ', 'success');
                };
                script.onerror = (error) => {
                    addDebug('ERROR', `â?loader.jsåŠ è½½å¤±è´¥: ${error}`);
                    addStatus('LoaderåŠ è½½å¤±è´¥', 'error');
                };
                document.head.appendChild(script);

            } catch (error) {
                addDebug('ERROR', `â?MAMEæµ‹è¯•åˆå§‹åŒ–å¤±è´? ${error.message}`);
                addStatus('MAMEæµ‹è¯•å¤±è´¥', 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            addDebug('INFO', 'ğŸ“„ è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ');
            addStatus('è°ƒè¯•ç¯å¢ƒå°±ç»ª', 'success');
        });
    </script>
</body>
</html> 
