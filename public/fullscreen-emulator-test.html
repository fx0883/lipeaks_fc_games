<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å± EmulatorJS æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #222;
            color: #fff;
            overflow-x: hidden;
        }
        
        .header {
            background: #333;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 60px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .emulator-fullscreen {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 100px;
            background: #000;
            border: 3px solid #00ff00;
        }
        
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #333;
            padding: 10px 20px;
            height: 100px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button.success {
            background: #28a745;
        }
        
        button.warning {
            background: #ffc107;
            color: #000;
        }
        
        button.danger {
            background: #dc3545;
        }
        
        .status-success {
            color: #00ff00;
        }
        
        .status-error {
            color: #ff0000;
        }
        
        .status-info {
            color: #00bfff;
        }
        
        h1 {
            font-size: 18px;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ® å…¨å± EmulatorJS æµ‹è¯•</h1>
        <div class="controls">
            <button onclick="testFC()" class="success">æµ‹è¯•FCæ¸¸æˆ</button>
            <button onclick="testMAME()" class="warning">æµ‹è¯•MAMEæ¸¸æˆ</button>
            <button onclick="checkEmulatorStatus()">æ£€æŸ¥çŠ¶æ€?/button>
            <button onclick="clearEmulator()" class="danger">æ¸…ç©ºæ¨¡æ‹Ÿå™?/button>
            <button onclick="clearStatus()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <div id="emulator" class="emulator-fullscreen">
        <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #888; font-size: 24px;">
            ğŸ® ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•æ¨¡æ‹Ÿå™¨
        </div>
    </div>

    <div id="status" class="status-bar">
        <div class="status-info">ğŸ“„ å…¨å±æ¨¡æ‹Ÿå™¨æµ‹è¯•é¡µé¢å°±ç»?- æ¨¡æ‹Ÿå™¨åŒºåŸŸå·²æœ€å¤§åŒ–æ˜¾ç¤º</div>
    </div>

    <script>
        let statusLog = [];
        
        function addStatus(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = `status-${type}`;
            statusLog.push(`<div class="${className}">[${timestamp}] ${message}</div>`);
            updateStatusDisplay();
            console.log(message);
        }
        
        function updateStatusDisplay() {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = statusLog.slice(-20).join(''); // åªæ˜¾ç¤ºæœ€è¿?0æ?
            statusEl.scrollTop = statusEl.scrollHeight;
        }
        
        function clearStatus() {
            statusLog = [];
            updateStatusDisplay();
        }
        
        function clearEmulator() {
            const container = document.getElementById('emulator');
            container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #888; font-size: 24px;">ğŸ® ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•æ¨¡æ‹Ÿå™¨</div>';
            
            // æ¸…ç†å…¨å±€å˜é‡
            delete window.EJS_emulator;
            delete window.EJS_player;
            delete window.EJS_gameUrl;
            delete window.EJS_system;
            delete window.EJS_pathtodata;
            delete window.EJS_gameName;
            
            // ç§»é™¤æ—§çš„è„šæœ¬
            const scripts = document.querySelectorAll('script[src*="loader.js"]');
            scripts.forEach(script => script.remove());
            
            addStatus('ğŸ§¹ æ¨¡æ‹Ÿå™¨å·²æ¸…ç©ºï¼Œå¯ä»¥é‡æ–°æµ‹è¯?, 'info');
        }
        
        function checkEmulatorStatus() {
            addStatus('ğŸ” å¼€å§‹æ£€æŸ¥æ¨¡æ‹Ÿå™¨çŠ¶æ€?..', 'info');
            
            const emulatorEl = document.getElementById('emulator');
            addStatus(`æ¨¡æ‹Ÿå™¨å®¹å™? ${emulatorEl ? 'âœ?å­˜åœ¨' : 'â?ä¸å­˜åœ?}`, emulatorEl ? 'success' : 'error');
            
            if (emulatorEl) {
                const hasContent = emulatorEl.innerHTML && !emulatorEl.innerHTML.includes('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®');
                addStatus(`æ¨¡æ‹Ÿå™¨å†…å®? ${hasContent ? 'âœ?æœ‰å†…å®? : 'â?ç©ºçš„æˆ–é»˜è®¤å†…å®?}`, hasContent ? 'success' : 'error');
                addStatus(`å­å…ƒç´ æ•°é‡? ${emulatorEl.children.length}`, 'info');
                
                // æ£€æŸ¥canvaså…ƒç´ 
                const canvas = emulatorEl.querySelector('canvas');
                if (canvas) {
                    addStatus(`âœ?æ‰¾åˆ°Canvaså…ƒç´ : ${canvas.width}x${canvas.height}`, 'success');
                } else {
                    addStatus('â?æœªæ‰¾åˆ°Canvaså…ƒç´ ', 'error');
                }
                
                // æ£€æŸ¥iframeå…ƒç´ 
                const iframe = emulatorEl.querySelector('iframe');
                if (iframe) {
                    addStatus(`âœ?æ‰¾åˆ°iframeå…ƒç´ : ${iframe.src}`, 'success');
                } else {
                    addStatus('â?æœªæ‰¾åˆ°iframeå…ƒç´ ', 'error');
                }
            }
            
            // æ£€æŸ¥å…¨å±€EmulatorJSå˜é‡
            if (window.EJS_emulator) {
                addStatus('âœ?å…¨å±€EJS_emulatorå­˜åœ¨', 'success');
            } else {
                addStatus('â?å…¨å±€EJS_emulatorä¸å­˜åœ?, 'error');
            }
            
            addStatus('ğŸ” æ¨¡æ‹Ÿå™¨çŠ¶æ€æ£€æŸ¥å®Œæˆ?, 'info');
        }
        
        function testFC() {
            clearEmulator();
            addStatus('ğŸ•¹ï¸?å¼€å§‹æµ‹è¯•FC/NES...', 'info');
            
            try {
                // è®¾ç½® EmulatorJS é…ç½® - FC/NES
                window.EJS_player = '#emulator';
                window.EJS_gameUrl = '/roms/Contra1(U)30.nes';
                window.EJS_system = 'nes';
                window.EJS_pathtodata = 'https://cdn.emulatorjs.org/4.2.3/data/';
                window.EJS_gameName = 'FC é­‚æ–—ç½—æµ‹è¯?;
                
                addStatus('FCé…ç½®å·²è®¾ç½? fceummæ ¸å¿ƒ + Contra1(U)30.nes', 'info');
                
                // åŠ è½½ EmulatorJS
                const script = document.createElement('script');
                script.src = 'https://cdn.emulatorjs.org/4.2.3/data/loader.js';
                script.onload = () => {
                    addStatus('âœ?EmulatorJS loader.js åŠ è½½æˆåŠŸ', 'success');
                    addStatus('â?æ­£åœ¨åˆå§‹åŒ–FC/NESæ¨¡æ‹Ÿå™?..', 'info');
                };
                script.onerror = (error) => {
                    addStatus('â?EmulatorJS loader.js åŠ è½½å¤±è´¥: ' + error, 'error');
                };
                document.head.appendChild(script);
                
            } catch (error) {
                addStatus('â?FCåˆå§‹åŒ–å¼‚å¸? ' + error.message, 'error');
                console.error('FC init error:', error);
            }
        }
        
        function testMAME() {
            clearEmulator();
            addStatus('ğŸ° å¼€å§‹æµ‹è¯•MAME2003...', 'info');
            
            try {
                // è®¾ç½® EmulatorJS é…ç½® - MAME
                window.EJS_player = '#emulator';
                window.EJS_gameUrl = '/roms/19xx.zip';
                window.EJS_system = 'mame';
                window.EJS_pathtodata = 'https://cdn.emulatorjs.org/4.2.3/data/';
                window.EJS_gameName = 'MAME è¡—æœºæµ‹è¯•';
                
                addStatus('MAMEé…ç½®å·²è®¾ç½? mame2003æ ¸å¿ƒ + 19xx.zip', 'info');
                
                // åŠ è½½ EmulatorJS
                const script = document.createElement('script');
                script.src = 'https://cdn.emulatorjs.org/4.2.3/data/loader.js';
                script.onload = () => {
                    addStatus('âœ?EmulatorJS loader.js åŠ è½½æˆåŠŸ', 'success');
                    addStatus('â?æ­£åœ¨åˆå§‹åŒ–MAME2003æ¨¡æ‹Ÿå™?..', 'info');
                };
                script.onerror = (error) => {
                    addStatus('â?EmulatorJS loader.js åŠ è½½å¤±è´¥: ' + error, 'error');
                };
                document.head.appendChild(script);
                
            } catch (error) {
                addStatus('â?MAMEåˆå§‹åŒ–å¼‚å¸? ' + error.message, 'error');
                console.error('MAME init error:', error);
            }
        }
        
        // ç›‘å¬å…¨å±€é”™è¯¯
        window.addEventListener('error', (e) => {
            addStatus('â?å…¨å±€é”™è¯¯: ' + (e.error?.message || e.message), 'error');
            console.error('Global error:', e.error || e);
        });
        
        // ç›‘å¬æœªå¤„ç†çš„Promiseé”™è¯¯
        window.addEventListener('unhandledrejection', (e) => {
            addStatus('â?Promiseé”™è¯¯: ' + e.reason, 'error');
            console.error('Unhandled promise rejection:', e.reason);
        });
        
        // æ·»åŠ EmulatorJSäº‹ä»¶ç›‘å¬
        window.addEventListener('message', (e) => {
            if (e.data && e.data.type) {
                addStatus(`ğŸ“¨ æ¥æ”¶åˆ°æ¶ˆæ? ${e.data.type}`, 'info');
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            addStatus('ğŸ“„ å…¨å±æ¨¡æ‹Ÿå™¨æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ?, 'success');
        });
    </script>
</body>
</html> 
