<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¦ç»†è°ƒè¯• EmulatorJS</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: Arial, sans-serif; }
        #emulator { width: 100vw; height: 60vh; background: #111; }
        .debug-panel { height: 40vh; background: #222; padding: 20px; overflow-y: auto; font-size: 12px; }
        .log { margin: 2px 0; padding: 2px 5px; border-radius: 3px; }
        .log.error { background: #ff4444; color: #fff; }
        .log.warn { background: #ffaa00; color: #000; }
        .log.info { background: #0088ff; color: #fff; }
        .log.success { background: #00ff44; color: #000; }
        .controls { position: absolute; top: 10px; right: 10px; z-index: 1000; }
        button { margin: 5px; padding: 8px 16px; border: none; border-radius: 4px; background: #4CAF50; color: white; cursor: pointer; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <div id="emulator"></div>
    
    <div class="controls">
        <button onclick="manualStart()">æ‰‹åŠ¨å¯åŠ¨</button>
        <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="debug-panel">
        <h3>ğŸ”§ è¯¦ç»†è°ƒè¯•æ—¥å¿—</h3>
        <div id="logs"></div>
    </div>

    <script>
        let logs = [];
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logs.push({timestamp, message, type});
            updateLogs();
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function updateLogs() {
            const logsEl = document.getElementById('logs');
            logsEl.innerHTML = logs.slice(-50).map(log => 
                `<div class="log ${log.type}">[${log.timestamp}] ${log.message}</div>`
            ).join('');
            logsEl.scrollTop = logsEl.scrollHeight;
        }
        
        function clearLogs() {
            logs = [];
            updateLogs();
        }
        
        function manualStart() {
            addLog('ğŸ”§ æ‰‹åŠ¨è§¦å‘EmulatorJSå¯åŠ¨', 'info');
            if (window.EJS_emulator && window.EJS_emulator.startButtonClicked) {
                window.EJS_emulator.startButtonClicked({});
                addLog('âœ… æ‰‹åŠ¨è°ƒç”¨startButtonClicked', 'success');
            } else {
                addLog('âŒ EJS_emulatoræˆ–startButtonClickedä¸å­˜åœ¨', 'error');
            }
        }
        
        // è®¾ç½®EmulatorJSé…ç½®
        addLog('ğŸ“ è®¾ç½®EmulatorJSé…ç½®', 'info');
        window.EJS_player = '#emulator';
        window.EJS_gameUrl = '/roms/Contra1(U)30.nes';
        window.EJS_core = 'fceumm';  // ä¿®æ­£ï¼šä½¿ç”¨EJS_coreè€Œä¸æ˜¯EJS_system
        window.EJS_pathtodata = '/emulatorjs/';  // ä¿®æ­£ï¼šä½¿ç”¨æ­£ç¡®çš„è·¯å¾„
        window.EJS_gameName = 'é­‚æ–—ç½—è¯¦ç»†è°ƒè¯•';
        window.EJS_startOnLoaded = true; // å°è¯•è‡ªåŠ¨å¯åŠ¨
        window.EJS_DEBUG_XX = true; // å¯ç”¨è°ƒè¯•æ¨¡å¼
        window.EJS_disableDatabases = true; // ç¦ç”¨æ•°æ®åº“ä»¥åŠ å¿«åŠ è½½
        
        addLog(`é…ç½®å®Œæˆ: core=${window.EJS_core}, startOnLoaded=${window.EJS_startOnLoaded}`, 'info');
        
        // åŠ«æŒconsoleæ–¹æ³•æ¥æ•è·EmulatorJSçš„å†…éƒ¨æ—¥å¿—
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('EmulatorJS') || message.includes('Loading') || message.includes('Download')) {
                addLog(`LOG: ${message}`, 'info');
            }
            originalLog.apply(console, args);
        };
        
        console.warn = function(...args) {
            const message = args.join(' ');
            addLog(`WARN: ${message}`, 'warn');
            originalWarn.apply(console, args);
        };
        
        console.error = function(...args) {
            const message = args.join(' ');
            addLog(`ERROR: ${message}`, 'error');
            originalError.apply(console, args);
        };
        
        // ç›‘å¬å…¨å±€é”™è¯¯
        window.addEventListener('error', (e) => {
            addLog(`å…¨å±€é”™è¯¯: ${e.error?.message || e.message}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            addLog(`Promiseé”™è¯¯: ${e.reason}`, 'error');
        });
        
        // åŠ è½½EmulatorJS
        addLog('ğŸ“¦ å¼€å§‹åŠ è½½EmulatorJS...', 'info');
        
        const script = document.createElement('script');
        script.src = '/emulatorjs/loader.js';  // ä¿®æ­£ï¼šä½¿ç”¨æ­£ç¡®çš„è·¯å¾„
        
        script.onload = () => {
            addLog('âœ… loader.jsåŠ è½½æˆåŠŸ', 'success');
            
            // ç›‘æ§EmulatorJSå¯¹è±¡çš„åˆ›å»º
            let checkCount = 0;
            const checkEmulator = setInterval(() => {
                checkCount++;
                
                if (window.EJS_emulator) {
                    addLog('ğŸ¯ EJS_emulatorå¯¹è±¡å·²åˆ›å»ºï¼', 'success');
                    
                    // æ£€æŸ¥EmulatorJSçš„é‡è¦æ–¹æ³•
                    const methods = ['startButtonClicked', 'downloadGameCore', 'getCore'];
                    methods.forEach(method => {
                        if (window.EJS_emulator[method]) {
                            addLog(`âœ… æ–¹æ³•å­˜åœ¨: ${method}`, 'success');
                        } else {
                            addLog(`âŒ æ–¹æ³•ç¼ºå¤±: ${method}`, 'error');
                        }
                    });
                    
                    // æ£€æŸ¥æ ¸å¿ƒæ£€æµ‹
                    if (window.EJS_emulator.getCore) {
                        const core = window.EJS_emulator.getCore();
                        addLog(`ğŸ® æ£€æµ‹åˆ°æ ¸å¿ƒ: ${core}`, 'info');
                    }
                    
                    // å°è¯•ç›‘å¬EmulatorJSäº‹ä»¶
                    if (window.EJS_emulator.on) {
                        window.EJS_emulator.on('ready', () => {
                            addLog('ğŸ® EmulatorJS readyäº‹ä»¶è§¦å‘', 'success');
                        });
                        
                        window.EJS_emulator.on('start-clicked', () => {
                            addLog('ğŸš€ start-clickedäº‹ä»¶è§¦å‘', 'success');
                        });
                        
                        window.EJS_emulator.on('start', () => {
                            addLog('ğŸ•¹ï¸ startäº‹ä»¶è§¦å‘ - æ¸¸æˆå¼€å§‹ï¼', 'success');
                        });
                        
                        addLog('ğŸ“¡ å·²æ³¨å†ŒEmulatorJSäº‹ä»¶ç›‘å¬å™¨', 'info');
                    }
                    
                    clearInterval(checkEmulator);
                    
                } else if (checkCount > 100) {
                    addLog('â° EmulatorJSåˆå§‹åŒ–è¶…æ—¶', 'error');
                    clearInterval(checkEmulator);
                } else if (checkCount % 10 === 0) {
                    addLog(`â³ ç­‰å¾…EmulatorJSåˆå§‹åŒ–... (${checkCount}/100)`, 'info');
                }
            }, 100);
        };
        
        script.onerror = () => {
            addLog('âŒ loader.jsåŠ è½½å¤±è´¥ï¼', 'error');
        };
        
        document.head.appendChild(script);
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            addLog('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ', 'success');
        });
    </script>
</body>
</html> 