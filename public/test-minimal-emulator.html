<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²¾ç®€ç‰?EmulatorJS æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .emulator-container {
            width: 100%;
            height: 600px;  /* ä»?00pxå¢åŠ åˆ?00px */
            border: 2px solid #333;
            border-radius: 5px;
            background: #000;
            margin: 15px 0;
            min-height: 600px;  /* æ·»åŠ æœ€å°é«˜åº?*/
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .debug {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® ç²¾ç®€ç‰?EmulatorJS æµ‹è¯•</h1>
        
        <div class="info">
            <strong>æµ‹è¯•è¯´æ˜ï¼?/strong>æ­¤é¡µé¢ç”¨äºæµ‹è¯•ç²¾ç®€ç‰ˆEmulatorJSï¼ŒåªåŒ…å«FC/NES (fceumm) å’?MAME2003 ä¸¤ä¸ªæ ¸å¿ƒã€?
            <br><strong>æ¨¡æ‹Ÿå™¨å°ºå¯¸ï¼š</strong>å·²å¢å¤§åˆ° 600px é«˜åº¦ï¼Œä¾¿äºè§‚å¯Ÿæ¸¸æˆè¿è¡ŒçŠ¶æ€ã€?
        </div>

        <!-- æ·»åŠ è°ƒè¯•ä¿¡æ¯åŒºåŸŸ -->
        <div class="test-section">
            <h2>ğŸ” è°ƒè¯•ä¿¡æ¯</h2>
            <button onclick="checkFiles()">æ£€æŸ¥æ–‡ä»¶çŠ¶æ€?/button>
            <button onclick="clearDebugLog()">æ¸…ç©ºè°ƒè¯•æ—¥å¿—</button>
            <button onclick="checkEmulatorStatus()">æ£€æŸ¥æ¨¡æ‹Ÿå™¨çŠ¶æ€?/button>
            <div id="debug-log" class="debug">ç‚¹å‡»"æ£€æŸ¥æ–‡ä»¶çŠ¶æ€?å¼€å§‹è¯Šæ–?..</div>
        </div>

        <div class="test-section">
            <h2>ğŸ•¹ï¸?FC/NES æµ‹è¯•</h2>
            <button onclick="testFC()">æµ‹è¯• FC/NES æ¸¸æˆ</button>
            <button onclick="clearEmulator()">æ¸…ç©ºæ¨¡æ‹Ÿå™?/button>
            <div id="fc-status" class="info">å‡†å¤‡æµ‹è¯• FC/NES æ¸¸æˆ</div>
        </div>

        <div class="test-section">
            <h2>ğŸ° MAME æµ‹è¯•</h2>
            <button onclick="testMAME()">æµ‹è¯• MAME è¡—æœºæ¸¸æˆ</button>
            <button onclick="clearEmulator()">æ¸…ç©ºæ¨¡æ‹Ÿå™?/button>
            <div id="mame-status" class="info">å‡†å¤‡æµ‹è¯• MAME è¡—æœºæ¸¸æˆ</div>
        </div>

        <div id="emulator" class="emulator-container"></div>
        
        <div id="general-status" class="info">
            <strong>çŠ¶æ€ï¼š</strong>é¡µé¢å·²åŠ è½½ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯?
        </div>
    </div>

    <script>
        let currentEmulator = null;
        let debugLog = [];
        
        function addDebugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            updateDebugDisplay();
            console.log(message);
        }
        
        function updateDebugDisplay() {
            const debugEl = document.getElementById('debug-log');
            debugEl.innerHTML = debugLog.join('<br>');
            debugEl.scrollTop = debugEl.scrollHeight;
        }
        
        function clearDebugLog() {
            debugLog = [];
            updateDebugDisplay();
        }
        
        async function checkFiles() {
            clearDebugLog();
            addDebugLog('ğŸ” å¼€å§‹æ£€æŸ¥æ–‡ä»¶çŠ¶æ€?..');
            
            // æ£€æŸ¥ROMæ–‡ä»¶
            const romFiles = ['/roms/Contra1(U)30.nes', '/roms/19xx.zip'];
            for (const romFile of romFiles) {
                try {
                    const response = await fetch(romFile, { method: 'HEAD' });
                    if (response.ok) {
                        addDebugLog(`âœ?ROMæ–‡ä»¶å­˜åœ¨: ${romFile}`);
                    } else {
                        addDebugLog(`â?ROMæ–‡ä»¶è®¿é—®å¤±è´¥: ${romFile} (çŠ¶æ€ç : ${response.status})`);
                    }
                } catch (error) {
                    addDebugLog(`â?ROMæ–‡ä»¶æ£€æŸ¥å‡ºé”? ${romFile} - ${error.message}`);
                }
            }
            
            // æ£€æŸ¥EmulatorJSæ–‡ä»¶
            const ejsFiles = [
                'https://cdn.emulatorjs.org/4.2.3/data/loader.js',
                'https://cdn.emulatorjs.org/4.2.3/data/emulator.min.js',
                'https://cdn.emulatorjs.org/4.2.3/data/emulator.min.css'
            ];
            for (const ejsFile of ejsFiles) {
                try {
                    const response = await fetch(ejsFile, { method: 'HEAD' });
                    if (response.ok) {
                        addDebugLog(`âœ?EmulatorJSæ–‡ä»¶å­˜åœ¨: ${ejsFile}`);
                    } else {
                        addDebugLog(`â?EmulatorJSæ–‡ä»¶è®¿é—®å¤±è´¥: ${ejsFile} (çŠ¶æ€ç : ${response.status})`);
                    }
                } catch (error) {
                    addDebugLog(`â?EmulatorJSæ–‡ä»¶æ£€æŸ¥å‡ºé”? ${ejsFile} - ${error.message}`);
                }
            }
            
            // æ£€æŸ¥æ ¸å¿ƒæ–‡ä»?
            const coreFiles = [
                'https://cdn.emulatorjs.org/4.2.3/data/cores/reports/fceumm.json',
                'https://cdn.emulatorjs.org/4.2.3/data/cores/reports/mame2003.json'
            ];
            for (const coreFile of coreFiles) {
                try {
                    const response = await fetch(coreFile, { method: 'HEAD' });
                    if (response.ok) {
                        addDebugLog(`âœ?æ ¸å¿ƒæŠ¥å‘Šæ–‡ä»¶å­˜åœ¨: ${coreFile}`);
                    } else {
                        addDebugLog(`â?æ ¸å¿ƒæŠ¥å‘Šæ–‡ä»¶è®¿é—®å¤±è´¥: ${coreFile} (çŠ¶æ€ç : ${response.status})`);
                    }
                } catch (error) {
                    addDebugLog(`â?æ ¸å¿ƒæŠ¥å‘Šæ–‡ä»¶æ£€æŸ¥å‡ºé”? ${coreFile} - ${error.message}`);
                }
            }
            
            addDebugLog('ğŸ” æ–‡ä»¶æ£€æŸ¥å®Œæˆï¼');
        }
        
        function updateStatus(elementId, message, type = 'info') {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = type;
            addDebugLog(`çŠ¶æ€æ›´æ–°[${elementId}]: ${message}`);
        }
        
        function clearEmulator() {
            const container = document.getElementById('emulator');
            container.innerHTML = '';
            
            // æ¸…ç†å…¨å±€å˜é‡
            delete window.EJS_emulator;
            delete window.EJS_player;
            delete window.EJS_gameUrl;
            delete window.EJS_system;
            delete window.EJS_pathtodata;
            delete window.EJS_gameName;
            
            // ç§»é™¤æ—§çš„è„šæœ¬
            const scripts = document.querySelectorAll('script[src*="loader.js"]');
            scripts.forEach(script => script.remove());
            
            addDebugLog('ğŸ§¹ æ¨¡æ‹Ÿå™¨å·²æ¸…ç©º');
            updateStatus('general-status', 'æ¨¡æ‹Ÿå™¨å·²æ¸…ç©ºï¼Œå¯ä»¥é‡æ–°æµ‹è¯?, 'info');
        }
        
        function testFC() {
            clearEmulator();
            addDebugLog('ğŸ•¹ï¸?å¼€å§‹æµ‹è¯•FC/NES...');
            updateStatus('fc-status', 'æ­£åœ¨åˆå§‹åŒ?FC/NES æ¨¡æ‹Ÿå™?..', 'info');
            updateStatus('general-status', 'åŠ è½½ FC/NES æ ¸å¿ƒä¸?..', 'info');
            
            try {
                // è®¾ç½® EmulatorJS é…ç½® - FC/NES
                window.EJS_player = '#emulator';
                window.EJS_gameUrl = '/roms/Contra1(U)30.nes';
                window.EJS_system = 'nes';
                window.EJS_pathtodata = 'https://cdn.emulatorjs.org/4.2.3/data/';
                window.EJS_gameName = 'FC é­‚æ–—ç½—æµ‹è¯?;
                
                const config = {
                    player: window.EJS_player,
                    gameUrl: window.EJS_gameUrl,
                    system: window.EJS_system,
                    pathtodata: window.EJS_pathtodata,
                    gameName: window.EJS_gameName
                };
                
                addDebugLog('FCé…ç½®: ' + JSON.stringify(config, null, 2));
                
                // åŠ è½½ EmulatorJS
                const script = document.createElement('script');
                script.src = 'https://cdn.emulatorjs.org/4.2.3/data/loader.js';
                script.onload = () => {
                    addDebugLog('âœ?EmulatorJS loader.js åŠ è½½æˆåŠŸ');
                    updateStatus('fc-status', 'FC/NES æ¨¡æ‹Ÿå™¨åŠ è½½æˆåŠŸï¼è¯·ç­‰å¾…æ¸¸æˆå¯åŠ?..', 'success');
                    updateStatus('general-status', 'FC/NES æ¨¡æ‹Ÿå™¨è¿è¡Œä¸­', 'success');
                };
                script.onerror = (error) => {
                    addDebugLog('â?EmulatorJS loader.js åŠ è½½å¤±è´¥: ' + error);
                    updateStatus('fc-status', 'FC/NES æ¨¡æ‹Ÿå™¨åŠ è½½å¤±è´¥ï¼', 'error');
                    updateStatus('general-status', 'åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾?, 'error');
                };
                document.head.appendChild(script);
                
            } catch (error) {
                addDebugLog('â?FCåˆå§‹åŒ–å¼‚å¸? ' + error.message);
                updateStatus('fc-status', 'FC/NES æ¨¡æ‹Ÿå™¨åˆå§‹åŒ–é”™è¯¯: ' + error.message, 'error');
                updateStatus('general-status', 'åˆå§‹åŒ–å¤±è´? ' + error.message, 'error');
                console.error('FC init error:', error);
            }
        }
        
        function testMAME() {
            clearEmulator();
            addDebugLog('ğŸ° å¼€å§‹æµ‹è¯•MAME2003...');
            updateStatus('mame-status', 'æ­£åœ¨åˆå§‹åŒ?MAME2003 æ¨¡æ‹Ÿå™?..', 'info');
            updateStatus('general-status', 'åŠ è½½ MAME2003 æ ¸å¿ƒä¸?..', 'info');
            
            try {
                // è®¾ç½® EmulatorJS é…ç½® - MAME
                window.EJS_player = '#emulator';
                window.EJS_gameUrl = '/roms/19xx.zip';
                window.EJS_system = 'mame';
                window.EJS_pathtodata = 'https://cdn.emulatorjs.org/4.2.3/data/';
                window.EJS_gameName = 'MAME è¡—æœºæµ‹è¯•';
                
                const config = {
                    player: window.EJS_player,
                    gameUrl: window.EJS_gameUrl,
                    system: window.EJS_system,
                    pathtodata: window.EJS_pathtodata,
                    gameName: window.EJS_gameName
                };
                
                addDebugLog('MAMEé…ç½®: ' + JSON.stringify(config, null, 2));
                
                // åŠ è½½ EmulatorJS
                const script = document.createElement('script');
                script.src = 'https://cdn.emulatorjs.org/4.2.3/data/loader.js';
                script.onload = () => {
                    addDebugLog('âœ?EmulatorJS loader.js åŠ è½½æˆåŠŸ');
                    updateStatus('mame-status', 'MAME2003 æ¨¡æ‹Ÿå™¨åŠ è½½æˆåŠŸï¼è¯·ç­‰å¾…æ¸¸æˆå¯åŠ?..', 'success');
                    updateStatus('general-status', 'MAME2003 æ¨¡æ‹Ÿå™¨è¿è¡Œä¸­', 'success');
                };
                script.onerror = (error) => {
                    addDebugLog('â?EmulatorJS loader.js åŠ è½½å¤±è´¥: ' + error);
                    updateStatus('mame-status', 'MAME2003 æ¨¡æ‹Ÿå™¨åŠ è½½å¤±è´¥ï¼', 'error');
                    updateStatus('general-status', 'åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾?, 'error');
                };
                document.head.appendChild(script);
                
            } catch (error) {
                addDebugLog('â?MAMEåˆå§‹åŒ–å¼‚å¸? ' + error.message);
                updateStatus('mame-status', 'MAME2003 æ¨¡æ‹Ÿå™¨åˆå§‹åŒ–é”™è¯¯: ' + error.message, 'error');
                updateStatus('general-status', 'åˆå§‹åŒ–å¤±è´? ' + error.message, 'error');
                console.error('MAME init error:', error);
            }
        }
        
        function checkEmulatorStatus() {
            addDebugLog('ğŸ” æ£€æŸ¥æ¨¡æ‹Ÿå™¨çŠ¶æ€?..');
            
            const emulatorEl = document.getElementById('emulator');
            addDebugLog(`æ¨¡æ‹Ÿå™¨å®¹å™? ${emulatorEl ? 'å­˜åœ¨' : 'ä¸å­˜åœ?}`);
            
            if (emulatorEl) {
                addDebugLog(`æ¨¡æ‹Ÿå™¨å®¹å™¨å†…å®? ${emulatorEl.innerHTML ? 'æœ‰å†…å®? : 'ç©ºçš„'}`);
                addDebugLog(`æ¨¡æ‹Ÿå™¨å­å…ƒç´ æ•°é‡: ${emulatorEl.children.length}`);
                
                // æ£€æŸ¥canvaså…ƒç´ 
                const canvas = emulatorEl.querySelector('canvas');
                if (canvas) {
                    addDebugLog(`âœ?æ‰¾åˆ°Canvaså…ƒç´ : ${canvas.width}x${canvas.height}`);
                } else {
                    addDebugLog('â?æœªæ‰¾åˆ°Canvaså…ƒç´ ');
                }
                
                // æ£€æŸ¥iframeå…ƒç´ 
                const iframe = emulatorEl.querySelector('iframe');
                if (iframe) {
                    addDebugLog(`âœ?æ‰¾åˆ°iframeå…ƒç´ : ${iframe.src}`);
                } else {
                    addDebugLog('â?æœªæ‰¾åˆ°iframeå…ƒç´ ');
                }
            }
            
            // æ£€æŸ¥å…¨å±€EmulatorJSå˜é‡
            if (window.EJS_emulator) {
                addDebugLog('âœ?å…¨å±€EJS_emulatorå­˜åœ¨');
            } else {
                addDebugLog('â?å…¨å±€EJS_emulatorä¸å­˜åœ?);
            }
            
            // æ£€æŸ¥å½“å‰é…ç½?
            const config = {
                player: window.EJS_player,
                gameUrl: window.EJS_gameUrl,
                system: window.EJS_system,
                pathtodata: window.EJS_pathtodata,
                gameName: window.EJS_gameName
            };
            addDebugLog('å½“å‰é…ç½®: ' + JSON.stringify(config, null, 2));
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            addDebugLog('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ');
            updateStatus('general-status', 'âœ?ç²¾ç®€ç‰?EmulatorJS æµ‹è¯•é¡µé¢å°±ç»ª', 'success');
        });
        
        // ç›‘å¬å…¨å±€é”™è¯¯
        window.addEventListener('error', (e) => {
            addDebugLog('â?å…¨å±€é”™è¯¯: ' + e.error?.message || e.message);
            updateStatus('general-status', 'å‘ç”Ÿé”™è¯¯: ' + (e.error?.message || e.message), 'error');
            console.error('Global error:', e.error || e);
        });
        
        // ç›‘å¬æœªå¤„ç†çš„Promiseé”™è¯¯
        window.addEventListener('unhandledrejection', (e) => {
            addDebugLog('â?Promiseé”™è¯¯: ' + e.reason);
            updateStatus('general-status', 'Promiseé”™è¯¯: ' + e.reason, 'error');
            console.error('Unhandled promise rejection:', e.reason);
        });
        
        // æ·»åŠ EmulatorJSäº‹ä»¶ç›‘å¬
        window.addEventListener('message', (e) => {
            if (e.data && e.data.type) {
                addDebugLog(`ğŸ“¨ æ¥æ”¶åˆ°æ¶ˆæ? ${e.data.type} - ${JSON.stringify(e.data)}`);
            }
        });
    </script>
</body>
</html> 
